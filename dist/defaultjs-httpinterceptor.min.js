(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}();const e="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t.g?t.g:{},r=e.fetch,n=e.location.origin;const o=new class{#t={};#e={};#r={};#n=!1;#o=[];#s=[];#i;constructor(){}set ignoreDocumentOrigin(t){this.#n=t}addOriginToIgnore(t){if(t instanceof Array)for(let e of t)this.#r[e.toString()]=!0;else this.#r[t.toString()]=!0}addUrlToIgnore(t){if(t instanceof Array)for(let e of t)this.#e[e.toString()]=!0;else this.#e[t.toString()]=!0}setup(t){("function"==typeof t||t instanceof Promise)&&this.#s.push(t)}addInterceptor(t){if(t instanceof Array)return t.forEach((t=>this.addInterceptor(t)));if("object"!=typeof t)throw new Error("function required an interceptor");if("function"!=typeof t.doAccept)throw new Error('The interceptor required a "doAccept" function!');if("function"!=typeof t.doHandle)throw new Error('The interceptor required a "doHandle" function!');this.#o.push(t),this.reset()}get ready(){return(async()=>0==this.#s.length||(this.#i||(this.#i=(async()=>{for(;0!=this.#s.length;){const t=this.#s[0];if(t){const e=t instanceof Promise?await t:await t();e&&(e instanceof Array?e.forEach((t=>this.addInterceptor(t))):this.addInterceptor(e))}this.#s.shift()}return this.#i=null,this.ready})()),this.#i))()}async doIntercept(t){await this.ready;const e=t.metadata.origin;if(this.#a(e,t.url.toString()))return t;const{url:r,metadata:n}=t,o=await this.#c(e,{url:r,metadata:n});if(!o)return t;for(let e of o)t=await e.doHandle(t);return t}reset(){this.#t={}}async uncheckedFetch(t,e){return r(t,e)}#a(t,e){return!!this.#e[e]||(!(!this.#n||t!=n)||!!this.#r[t])}async#c(t,e){let r=this.#t[t];return r||(r=this.#h(t,e),this.#t[t]=r),r}async#h(t,e){const r=[];for(let t of this.#o)await t.doAccept(e)&&r.push(t);return r}};setTimeout((()=>o.ready),10);const s=o;var i;i=window.XMLHttpRequest,window.XMLHttpRequest=class extends i{#d;constructor(t){super(t)}setRequestHeader(t,e){this.#d.request.headers=this.#d.request.headers||{},this.#d.request.headers[t]=e}open(t,r,n,o,s){const i=new URL(r,e.location.origin);this.#d={url:new URL(r,location),request:{method:t},metadata:{method:t,origin:i.origin,protocol:i.protocol,hostname:i.hostname,port:i.port,path:i.pathname,query:i.search,hash:i.hash,async:"boolean"!=typeof n||n,username:o,password:s}}}send(t){this.#d.request.body=t,s.doIntercept(this.#d).then((t=>{console.log(t);const{url:e,request:r,metadata:n}=t,{method:o,headers:s,body:i}=r,{async:a,username:c,password:h}=n,d="string"==typeof e?e:e.toString();super.open(o,d,a,c,c),void 0!==s&&Object.getOwnPropertyNames(s).forEach((t=>super.setRequestHeader(t,s[t]))),super.send(i)})).catch(console.error)}},e.fetch=async function(t,n){const o=new URL(t,e.location),i=await s.doIntercept({url:new URL(t,location),request:n||{},metadata:{method:void 0===n?"GET":n.method||"GET",origin:o.origin,protocol:o.protocol,hostname:o.hostname,port:o.port,path:o.pathname,hash:o.hash,query:o.search,async:!0}});return r(i.url,i.request)};class a{async doAccept(t){}async doHandle(t){}async unceckedFetch(t,e){return r(t,e)}}const c=async(t,e)=>(e.request.headers=e.request.headers||{},e.request.headers.Authorization=`Bearer ${t}`,e);class h extends a{#u=null;#f={};#p;#l;#g;#y;#w;constructor({condition:t,fetchToken:e,appendToken:r,refreshInterval:n=6e4,refreshToken:o}){if(super(),"string"!=typeof t&&!(t instanceof Array)&&"function"!=typeof t)throw new Error('Parameter "condition" must be a "string", "array" or "function"!');if(this.#p=t,"function"!=typeof e)throw new Error('Parameter "fetchToken" must be a "function"!');if(this.#l=e,r&&"function"!=typeof r)throw new Error('Parameter "appendToken" must be a "function"!');this.#g=r||c,this.#y=n,this.#w=o}async doAccept(t){const e=typeof this.#p,r=this.#p,n=t.metadata.origin;return"function"===e?await r(t):"string"===e?r==n:r instanceof Array&&r.includes(n)}async doHandle(t){if(!this.#u){const{url:e,metadata:r}=t;this.#f={url:e,metadata:r},this.#u=this.#l({url:e,metadata:r}),this.#m()}return this.#k(t)}async#k(t){const e=this.#g,r=await this.#u,n=await e(r,t);return n||t}#m(){if(this.#y>0){this.#w;const t=async()=>{this.#w?await this.#w(this.#f):await this.#l(this.#f),setTimeout(t,this.#y)};setTimeout(t,this.#y)}}}const d={OAuthInterceptor:function(t){const e=t;return e.fetchToken=async()=>{const t=await fetch(e.login.url,{method:e.login.method||"get"});return t=await t.json(),t[e.login.response.valueSelector]},h(t)},TokenInterceptor:h};e.defaultjs=e.defaultjs||{},e.defaultjs.httpinterceptor=e.defaultjs.httpinterceptor||{VERSION:"${version}",Manager:s,Interceptor:a,interceptors:d}})();
//# sourceMappingURL=defaultjs-httpinterceptor.min.js.map