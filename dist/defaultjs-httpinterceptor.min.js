(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}();const t="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e.g?e.g:{},r=t.fetch;class n{async doAccept(e){}async doHandle(e){}async unceckedFetch(e,t){return r(e,t)}}const o=t.location.origin;const s=new class{#e=new Map;#t=new Set;#r=new Set;#n=!1;#o=[];#s=[];#i=null;constructor(){}set ignoreDocumentOrigin(e){this.#n=e}addOriginToIgnore(e){if(Symbol.iterator in e)for(let t of e)this.#r.add(t.toString());else this.#r[e.toString()]=!0}addUrlToIgnore(e){if(Symbol.iterator in e)for(let t of e)this.#t.add(t.toString());else this.#t.add(e.toString())}setup(e){("function"==typeof e||e instanceof Promise)&&this.#s.push(e)}addInterceptor(e){if(Symbol.iterator in e)for(interceptor of e)this.addInterceptor(interceptor);if("object"!=typeof e)throw new Error("function required an interceptor");if("function"!=typeof e.doAccept)throw new Error('The interceptor required a "doAccept" function!');if("function"!=typeof e.doHandle)throw new Error('The interceptor required a "doHandle" function!');this.#o.push(e),this.reset()}get ready(){return(()=>0==this.#s.length||(this.#i||(this.#i=(async()=>{for(;0!=this.#s.length;){const e=this.#s.shift(),t=await(e instanceof Promise?e:e());if(t)if(Symbol.iterator in t)for(interceptor of t)this.addInterceptor(interceptor);else this.addInterceptor(t)}return this.#i=null,this.ready})()),this.#i))()}async doIntercept(e){await this.ready;const{url:t,metadata:r}=e,{origin:n}=r;if(this.#a(n,e.url.toString()))return e;const o=await this.#c(n,{url:t,metadata:r});if(!o)return e;for(let t of o)e=await t.doHandle(e)||e;return e}reset(){this.#e=new Map}async uncheckedFetch(e,t){return r(e,t)}#a(e,t){return!!this.#t.has(t)||(!(!this.#n||e!=o)||!!this.#r[e])}async#c(e,t){let r=this.#e.get(e);return r||(r=this.#h(t),this.#e.set(e,r)),r}async#h(e){const t=[];for(let r of this.#o)await r.doAccept(e)&&t.push(r);return t}};setTimeout((()=>s.ready),100);const i=s;var a;a=t.XMLHttpRequest,t.XMLHttpRequest=class extends a{#d;constructor(e){super(e)}setRequestHeader(e,t){this.#d.request.headers=this.#d.request.headers||{},this.#d.request.headers[e]=t}open(e,r,n,o,s){const i=r instanceof URL?r:new URL(r,t.location);this.#d={url:i,request:{method:e},metadata:{method:e,origin:i.origin,protocol:i.protocol,hostname:i.hostname,port:i.port,path:i.pathname,query:i.search,hash:i.hash,async:"boolean"!=typeof n||n,username:o,password:s}}}send(e){this.#d.request.body=e,i.doIntercept(this.#d).then((e=>{console.log(e);const{url:t,request:r,metadata:n}=e,{method:o,headers:s,body:i}=r,{async:a,username:c,password:h}=n,d="string"==typeof t?t:t.toString();super.open(o,d,a,c,h),void 0!==s&&Object.getOwnPropertyNames(s).forEach((e=>super.setRequestHeader(e,s[e]))),super.send(i)})).catch(console.error)}},t.fetch=async function(e,n){const o=e instanceof URL?e:new URL(e,t.location),s=await i.doIntercept({url:o,request:n||{},metadata:{method:void 0===n?"GET":n.method||"GET",origin:o.origin,protocol:o.protocol,hostname:o.hostname,port:o.port,path:o.pathname,hash:o.hash,query:o.search,async:!0}});return r(s.url,s.request)};const c=async(e,t)=>(t.request.headers=t.request.headers||{},t.request.headers.Authorization=`Bearer ${e}`,t);class h extends n{#u=null;#f={};#p;#l;#g;#y;#m;constructor({condition:e,fetchToken:t,appendToken:r,refreshInterval:n=6e4,refreshToken:o}){if(super(),"string"!=typeof e&&!(e instanceof Array)&&"function"!=typeof e)throw new Error('Parameter "condition" must be a "string", "array" or "function"!');if(this.#p=e,"function"!=typeof t)throw new Error('Parameter "fetchToken" must be a "function"!');if(this.#l=t,r&&"function"!=typeof r)throw new Error('Parameter "appendToken" must be a "function"!');this.#g=r||c,this.#y=n,this.#m=o}async doAccept(e){const t=typeof this.#p,r=this.#p,n=e.metadata.origin;return"function"===t?await r(e):"string"===t?r==n:r instanceof Array&&r.includes(n)}async doHandle(e){if(!this.#u){const{url:t,metadata:r}=e;this.#f={url:t,metadata:r},this.#u=this.#l({url:t,metadata:r}),this.#w()}return this.#k(e)}async#k(e){const t=this.#g,r=await this.#u,n=await t(r,e);return n||e}#w(){if(this.#y>0){this.#m;const e=async()=>{this.#m?await this.#m(this.#f):await this.#l(this.#f),setTimeout(e,this.#y)};setTimeout(e,this.#y)}}}const d={OAuthInterceptor:function(e){const t=e;return t.fetchToken=async()=>{const e=await fetch(t.login.url,{method:t.login.method||"get"});return e=await e.json(),e[t.login.response.valueSelector]},h(e)},TokenInterceptor:h};t.defaultjs=t.defaultjs||{},t.defaultjs.httpinterceptor=t.defaultjs.httpinterceptor||{VERSION:"${version}",Manager:i,Interceptor:n,interceptors:d}})();
//# sourceMappingURL=defaultjs-httpinterceptor.min.js.map