(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}();const e="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t.g?t.g:{},r=e.fetch,n=e.location.origin;const o=new class{#t={};#e={};#r={};#n=!1;#o=[];#i=[];#s;constructor(){}set ignoreDocumentOrigin(t){this.#n=t}addOriginToIgnore(t){if(t instanceof Array)for(let e of t)this.#r[e.toString()]=!0;else this.#r[t.toString()]=!0}addUrlToIgnore(t){if(t instanceof Array)for(let e of t)this.#e[e.toString()]=!0;else this.#e[t.toString()]=!0}setup(t){("function"==typeof t||t instanceof Promise)&&this.#i.push(t)}addInterceptor(t){if(t instanceof Array)return t.forEach((t=>this.addInterceptor(t)));if("object"!=typeof t)throw new Error("function required an interceptor");if("function"!=typeof t.doAccept)throw new Error('The interceptor required a "doAccept" function!');if("function"!=typeof t.doHandle)throw new Error('The interceptor required a "doHandle" function!');this.#o.push(t),this.reset()}get ready(){return(async()=>0==this.#i.length||(this.#s||(this.#s=(async()=>{for(;0!=this.#i.length;){const t=this.#i[0];if(t){const e=t instanceof Promise?await t:await t();e&&(e instanceof Array?e.forEach((t=>this.addInterceptor(t))):this.addInterceptor(e))}this.#i.shift()}return this.#s=null,this.ready})()),this.#s))()}async doIntercept(t){await this.ready;const e=t.metadata.origin;if(this.#a(e,t.url.toString()))return t;const{url:r,metadata:n}=t,o=await this.#c(e,{url:r,metadata:n});if(!o)return t;for(let e of o)t=await e.doHandle(t);return t}reset(){this.#t={}}async uncheckedFetch(t,e){return r(t,e)}#a(t,e){return!!this.#e[e]||(!(!this.#n||t!=n)||!!this.#r[t])}async#c(t,e){let r=this.#t[t];return r||(r=this.#h(t,e),this.#t[t]=r),r}async#h(t,e){const r=[];for(let t of this.#o)await t.doAccept(e)&&r.push(t);return r}};setTimeout((()=>o.ready),10);const i=o;if(void 0!==e.XMLHttpRequest){const t=e.XMLHttpRequest,r=t.prototype.open,n=t.prototype.setRequestHeader,o=t.prototype.send,s=(t,{url:e,request:{method:i,headers:s,body:a},metadata:{async:c,username:h,password:d}})=>{e="string"==typeof e?e:e.toString(),r.call(t,i,e,c,h,d),void 0!==s&&Object.getOwnPropertyNames(s).forEach((e=>{n.call(t,e,s[e])})),o.call(t,a)},a=function(){const r=new t(arguments);let n;return r.setRequestHeader=function(t,e){n.request.headers=n.request.headers||{},n.request.headers[t]=e},r.open=function(t,r,o,i,s){const a=new URL(r,e.location.origin);n={url:new URL(r,location),request:{method:t},metadata:{method:t,origin:a.origin,protocol:a.protocol,hostname:a.hostname,port:a.port,path:a.pathname,query:a.search,hash:a.hash,async:"boolean"!=typeof o||o,username:i,password:s}}},r.send=function(t){n.request.body=t,i.doIntercept(n).then((t=>s(r,t))).catch(console.error)},r};e.XMLHttpRequest=a}e.fetch=async function(t,n){const o=new URL(t,e.location),s=await i.doIntercept({url:new URL(t,location),request:n||{},metadata:{method:void 0===n?"GET":n.method||"GET",origin:o.origin,protocol:o.protocol,hostname:o.hostname,port:o.port,path:o.pathname,hash:o.hash,query:o.search,async:!0}});return r(s.url,s.request)};class s{async doAccept(t){}async doHandle(t){}async unceckedFetch(t,e){return r(t,e)}}const a=async(t,e)=>(e.request.headers=e.request.headers||{},e.request.headers.Authorization=`Bearer ${t}`,e);class c extends s{#d=null;#u={};#f;#p;#l;#g;#y;constructor({condition:t,fetchToken:e,appendToken:r,refreshInterval:n=6e4,refreshToken:o}){if(super(),"string"!=typeof t&&!(t instanceof Array)&&"function"!=typeof t)throw new Error('Parameter "condition" must be a "string", "array" or "function"!');if(this.#f=t,"function"!=typeof e)throw new Error('Parameter "fetchToken" must be a "function"!');if(this.#p=e,r&&"function"!=typeof r)throw new Error('Parameter "appendToken" must be a "function"!');this.#l=r||a,this.#g=n,this.#y=o}async doAccept(t){const e=typeof this.#f,r=this.#f,n=t.metadata.origin;return"function"===e?await r(t):"string"===e?r==n:r instanceof Array&&r.includes(n)}async doHandle(t){if(!this.#d){const{url:e,metadata:r}=t;this.#u={url:e,metadata:r},this.#d=this.#p({url:e,metadata:r}),this.#w()}return this.#m(t)}async#m(t){const e=this.#l,r=await this.#d,n=await e(r,t);return n||t}#w(){if(this.#g>0){this.#y;const t=async()=>{this.#y?await this.#y(this.#u):await this.#p(this.#u),setTimeout(t,this.#g)};setTimeout(t,this.#g)}}}const h={OAuthInterceptor:function(t){const e=t;return e.fetchToken=async()=>{const t=await fetch(e.login.url,{method:e.login.method||"get"});return t=await t.json(),t[e.login.response.valueSelector]},c(t)},TokenInterceptor:c};e.defaultjs=e.defaultjs||{},e.defaultjs.httpinterceptor=e.defaultjs.httpinterceptor||{VERSION:"${version}",Manager:i,Interceptor:s,interceptors:h}})();
//# sourceMappingURL=defaultjs-httpinterceptor.min.js.map