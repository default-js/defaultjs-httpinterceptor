(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}();const e="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t.g?t.g:{},r=e.fetch,n=e.location.origin;const o=new class{#t={};#e={};#r={};#n=!1;#o=[];#s=[];#i;constructor(){}set ignoreDocumentOrigin(t){this.#n=t}addOriginToIgnore(t){if(t instanceof Array)for(let e of t)this.#r[e.toString()]=!0;else this.#r[t.toString()]=!0}addUrlToIgnore(t){if(t instanceof Array)for(let e of t)this.#e[e.toString()]=!0;else this.#e[t.toString()]=!0}setup(t){("function"==typeof t||t instanceof Promise)&&this.#s.push(t)}addInterceptor(t){if(t instanceof Array)return t.forEach((t=>this.addInterceptor(t)));if("object"!=typeof t)throw new Error("function required an interceptor");if("function"!=typeof t.doAccept)throw new Error('The interceptor required a "doAccept" function!');if("function"!=typeof t.doHandle)throw new Error('The interceptor required a "doHandle" function!');this.#o.push(t),this.reset()}get ready(){return(async()=>0==this.#s.length||(this.#i||(this.#i=(async()=>{for(;0!=this.#s.length;){const t=this.#s[0];if(t){const e=t instanceof Promise?await t:await t();e&&(e instanceof Array?e.forEach((t=>this.addInterceptor(t))):this.addInterceptor(e))}this.#s.shift()}return this.#i=null,this.ready})()),this.#i))()}async doIntercept(t){await this.ready;const e=t.metadata.origin;if(this.#a(e,t.url.toString()))return t;const{url:r,metadata:n}=t,o=await this.#c(e,{url:r,metadata:n});if(!o)return t;for(let e of o)t=await e.doHandle(t);return t}reset(){this.#t={}}async uncheckedFetch(t,e){return r(t,e)}#a(t,e){return!!this.#e[e]||(!(!this.#n||t!=n)||!!this.#r[t])}async#c(t,e){let r=this.#t[t];return r||(r=this.#h(t,e),this.#t[t]=r),r}async#h(t,e){const r=[];for(let t of this.#o)await t.doAccept(e)&&r.push(t);return r}};setTimeout((()=>o.ready),10);const s=o;if(void 0!==e.XMLHttpRequest){const t=e.XMLHttpRequest,r=function(e){t.prototype.open.call(this,e.request.method,e.url,e.metadata.async,e.metadata.username,e.metadata.password),void 0!==e.request.headers&&Object.getOwnPropertyNames(e.request.headers).forEach((r=>{t.prototype.setRequestHeader.call(this,r,e.request.headers[r])})),t.prototype.send.call(this,e.request.body)},n=function(){const n=new t(arguments);let o;return n.setRequestHeader=function(t,e){o.request.headers=o.request.headers||{},o.request.headers[t]=e},n.open=function(t,r,n,s,i){const a=new URL(r,e.location.origin);o={url:new URL(r,location),request:{method:t},metadata:{method:t,origin:a.origin,protocol:a.protocol,hostname:a.hostname,port:a.port,path:a.pathname,query:a.search,hash:a.hash,async:"boolean"!=typeof n||n,username:s,password:i}}},n.send=function(t){o.metadata.async?(o.request.body=t,s.doIntercept(o).then(r.bind(n)).catch(console.error)):r.call(n,o)},n};e.XMLHttpRequest=n,e.XMLHttpRequest.prototype=t.prototype,e.XMLHttpRequest.prototype.constructor=n}e.fetch=async function(t,n){const o=new URL(t,e.location),i=await s.doIntercept({url:new URL(t,location),request:n||{},metadata:{method:void 0===n?"GET":n.method||"GET",origin:o.origin,protocol:o.protocol,hostname:o.hostname,port:o.port,path:o.pathname,hash:o.hash,query:o.search,async:!0}});return r(i.url,i.request)};class i{async doAccept(t){}async doHandle(t){}async unceckedFetch(t,e){return r(t,e)}}const a=async(t,e)=>(e.request.headers=e.request.headers||{},e.request.headers.Authorization=`Bearer ${t}`,e);class c extends i{#d=null;#u={};#f;#p;#l;#y;#g;constructor({condition:t,fetchToken:e,appendToken:r,refreshInterval:n=6e4,refreshToken:o}){if(super(),"string"!=typeof t&&!(t instanceof Array)&&"function"!=typeof t)throw new Error('Parameter "condition" must be a "string", "array" or "function"!');if(this.#f=t,"function"!=typeof e)throw new Error('Parameter "fetchToken" must be a "function"!');if(this.#p=e,r&&"function"!=typeof r)throw new Error('Parameter "appendToken" must be a "function"!');this.#l=r||a,this.#y=n,this.#g=o}async doAccept(t){const e=typeof this.#f,r=this.#f,n=t.metadata.origin;return"function"===e?await r(t):"string"===e?r==n:r instanceof Array&&r.includes(n)}async doHandle(t){if(!this.#d){const{url:e,metadata:r}=t;this.#u={url:e,metadata:r},this.#d=this.#p({url:e,metadata:r}),this.#m()}return this.#w(t)}async#w(t){const e=this.#l,r=await this.#d,n=await e(r,t);return n||t}#m(){if(this.#y>0){this.#g;const t=async()=>{this.#g?await this.#g(this.#u):await this.#p(this.#u),setTimeout(t,this.#y)};setTimeout(t,this.#y)}}}const h={OAuthInterceptor:function(t){const e=t;return e.fetchToken=async()=>{const t=await fetch(e.login.url,{method:e.login.method||"get"});return t=await t.json(),t[e.login.response.valueSelector]},c(t)},TokenInterceptor:c};e.defaultjs=e.defaultjs||{},e.defaultjs.httpinterceptor=e.defaultjs.httpinterceptor||{VERSION:"${version}",Manager:s,Interceptor:i,interceptors:h}})();
//# sourceMappingURL=defaultjs-httpinterceptor.min.js.map