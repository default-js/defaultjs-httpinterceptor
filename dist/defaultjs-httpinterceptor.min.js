(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}();const t="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e.g?e.g:{},r=t.fetch,n=t.location.origin;const o=new class{#e={};#t={};#r={};#n=!1;#o=[];constructor(){}ignoreDocumentOrigin(e){this.#n=e}addOriginToIgnore(e){if(e instanceof Array)for(let t of e)this.#r[e]=!0;else this.#r[e]=!0}addUrlToIgnore(e){if(e instanceof Array)for(let t of e)this.#t[t]=!0;else this.#t[e]=!0}addInterceptor(e){if("object"!=typeof e)throw new Error("function required an interceptor");if("function"!=typeof e.doAccept)throw new Error('The interceptor required a "doAccept" function!');if("function"!=typeof e.doHandle)throw new Error('The interceptor required a "doHandle" function!');this.#o.push(e),this.reset()}async doIntercept(e){const t=e.metadata.origin;if(this.#s(t,e.url.toString()))return e;const{url:r,metadata:n}=e,o=await this.#i(t,{url:r,metadata:n});if(!o)return e;for(let t of o)e=await t.doHandle(e);return e}reset(){this.#e={}}async uncheckedFetch(e,t){return r(e,t)}#s(e,t){return!!this.#t[t]||(!(!this.#n||e!=n)||!!this.#r[e])}async#i(e,t){let r=this.#e[e];return r||(r=this.#a(e,t),this.#e[e]=r),r}async#a(e,t){const r=[];for(let e of this.#o)await e.doAccept(t)&&r.push(e);return r}};if(void 0!==t.XMLHttpRequest){const e=t.XMLHttpRequest,r=function(t){e.prototype.open.call(this,t.request.method,t.url,t.metadata.async,t.metadata.username,t.metadata.password),void 0!==t.request.headers&&Object.getOwnPropertyNames(t.request.headers).forEach((r=>{e.prototype.setRequestHeader.call(this,r,t.request.headers[r])})),e.prototype.send.call(this,t.request.body)},n=function(){const n=new e(arguments);let s;return n.setRequestHeader=function(e,t){s.request.headers=s.request.headers||{},s.request.headers[e]=t},n.open=function(e,r,n,o,i){const a=new URL(r,t.location.origin);s={url:r,request:{method:e},metadata:{method:e,origin:a.origin,protocol:a.protocol,hostname:a.hostname,port:a.port,path:a.pathname,query:a.search,hash:a.hash,async:"boolean"!=typeof n||n,username:o,password:i}}},n.send=function(e){s.metadata.async?(s.request.body=e,o.doIntercept(s).then(r.bind(n)).catch(console.error)):r.call(n,s)},n};t.XMLHttpRequest=n,t.XMLHttpRequest.prototype=e.prototype,t.XMLHttpRequest.prototype.constructor=n}t.fetch=async function(e,n){const s=new URL(e,t.location),i=await o.doIntercept({url:e,request:n||{},metadata:{method:void 0===n?"GET":n.method||"GET",origin:s.origin,protocol:s.protocol,hostname:s.hostname,port:s.port,path:s.pathname,hash:s.hash,query:s.search,async:!0}});return r(i.url,i.request)};class s{async doAccept(e){}async doHandle(e){}async unceckedFetch(e,t){return r(e,t)}}class i extends s{#c=null;#h={};#d;#u;#f;#p;#l;constructor({condition:e,fetchToken:t,appendToken:r,refreshInterval:n=6e4,refreshToken:o}){if(super(),"string"!=typeof e&&!(e instanceof Array)&&"function"!=typeof e)throw new Error('Parameter "condition" must be a "string", "array" or "function"!');if(this.#d=e,"function"!=typeof t)throw new Error('Parameter "fetchToken" must be a "function"!');if(this.#u=t,"function"!=typeof r)throw new Error('Parameter "appendToken" must be a "function"!');this.#f=r,this.#p=n,this.#l=o}async doAccept(e){const t=typeof this.#d,r=this.#d,n=e.metadata.origin;return"function"===t?await r(e):"string"===t?r==n:r instanceof Array&&r.includes(n)}async doHandle(e){if(!this.#c){const{url:t,metadata:r}=e;this.#h={url:t,metadata:r},this.#c=this.#u({url:t,metadata:r}),this.#g()}return this.#y(e)}async#y(e){const t=this.#f,r=await this.#c,n=await t(r,e);return n||e}#g(){if(this.#p>0){this.#l;setInterval((()=>{this.#l?this.#l(this.#h):this.#u(this.#h)}),this.#p)}}}const a={Interceptor:s,OAuthInterceptor:function(e){const t=e;return t.fetchToken=async()=>{const e=await fetch(t.login.url,{method:t.login.method||"get"});return e=await e.json(),e[t.login.response.valueSelector]},t.appendToken=function(e,t){return t.request.headers=t.request.headers||{},t.request.headers.Authorization="Bearer "+e,t},i(e)},TokenInterceptor:i};t.defaultjs=t.defaultjs||{},t.defaultjs.httpinterceptor=t.defaultjs.httpinterceptor||{VERSION:"${version}",Manager:o,interceptors:a}})();
//# sourceMappingURL=defaultjs-httpinterceptor.min.js.map